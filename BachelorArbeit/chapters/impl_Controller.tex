\subsection{Controller/MainServer}

Als Schnittstelle zwischen Benutzer und Anwendung wurde die Klasse \courier{Controller} eingef\"uhrt. Sie wird vom Anwender \"uber den sogenannten MBean-Server angesprochen. Die Klasse \courier{Controller} ist in der Anwendung f\"ur die Steuerung der Fehlerinjektion und weiteren Funktionalit√§ten verantwortlich. Der Client bekommt die f\"ur ihn vorgesehene Funktionalit\"at durch das Interface \courier{ControllerMBean} aus Listing \ref{lstController2}. Das Interface stellt alle nach au\ss en sichtbaren Methoden bereit und muss vom \courier{Controller} implementiert werden. Der \courier{Controller} ist somit \"uber das Interface ansprechbar, alle weiteren Implementierungsdetails bleiben nach au\ss en verborgen.

\begin{figure}[!htb]
	\lstinputlisting[style=stJava,caption={ControllerMBean}, label=lstController2]{listings/Controller2.java}
\end{figure}

Die Implementierung des \courier{MainServer} ist in Listing \ref{lstController3} dargestellt. Um die Java Management Extensions nutzen zu k\"onnen, muss zun\"achst ein \courier{MBeanServer} Objekt durch den Aufruf der Methode \courier{getPlatformMBeanServer} der Klasse \courier{java.lang.management.ManagementFactory} erstellt werden. Danach wird ein \courier{ObjectName} f\"ur das zu erstellende \courier{Controller} MBean definiert. Dieses besteht aus einer Domain und einer Liste von key-properties. Die Domain ist das \courier{package} in dem sich das zu erstellende MBean befindet. In Listing \ref{lstController3} ist dies das \courier{package jmx}. Die key-property spezifiziert den Typen des Objektes, in diesem Fall der Typ \courier{Controller}. Im Anschluss wird eine Objektinstanz des \courier{Controllers} erzeugt. Dieses kann nun als MBean mit dem \courier{ObjectName} Objekt am \courier{MBeanServer} registriert werden. Nach dem Starten der Klasse \courier{MainServer} wird auf die Aufrufe der im \courier{ControllerMBean} definierten Methoden gewartet, welche dann \"uber den \courier{Controller} ausgef\"uhrt werden.

\begin{figure}[!htb]
	\lstinputlisting[style=stJava,caption={MainServer}, label=lstController3]{listings/Controller3.java}
\end{figure}

 F\"ur die M\"oglichkeit einer zus\"atzlichen RMI Connection wurde die Implementierung aus Listing \ref{lstController1} verwendet. Falls keine Parameter mitgegeben wurden, wird die Klasse \courier{Mainserver} wie bisher gestartet. Andernfalls existiert die Klasse \courier{JMXServiceURL} aus \courier{javax.manage-\\ment.remote}, der sich Hostname und Port als Parameter \"ubergeben lassen. Die somit erstellte URL wird mit dem MBean Server \"uber einen \courier{JMXConnectorServer} verkn\"upft.

\begin{figure}[!htb]
	\lstinputlisting[style=stJava,caption={MainServer RMI}, label=lstController1]{listings/Controller1.java}
\end{figure}